package images

import (
	"bytes"
	"io"
	"os"
	"testing"

	"github.com/gmrtd/gmrtd/utils"
)

var dg2Data = "75823a637f61823a5e0201017f60823a56a10e81010282010087020101880200085f2e823a41464143003031300000003a41000100003a3300000000000000000000000000000000010101c102570103000000000000000c6a5020200d0a870a00000014667479706a703220000000006a70322000000158786d6c203c3f786d6c2076657273696f6e3d22312e302220656e636f64696e673d225554462d38223f3e0a3c434f4e54454e545f4445534352495054494f4e20786d6c6e733d22687474703a2f2f7777772e6a7065672e6f72672f6a70782f312e302f786d6c2220786d6c6e733a7873693d22687474703a2f2f7777772e77332e6f72672f323030312f584d4c536368656d612d696e7374616e636522207873693a736368656d614c6f636174696f6e3d22687474703a2f2f7777772e6a7065672e6f72672f6a70782f312e302f786d6c20687474703a2f2f7777772e6a7065672e6f72672f6d657461646174612f31353434342d322e787364223e0a3c50524f50455254593e0a3c4e414d453e414e3c2f4e414d453e0a3c56414c55453e3339353035363237343c2f56414c55453e0a3c2f50524f50455254593e0a3c2f434f4e54454e545f4445534352495054494f4e3e0a000000476a703268000000166968647200000257000001c10003070700000000000f636f6c72010000000000100000001a7265732000000012726573633d8400013d8400010000000000006a703263ff4fff51002f0000000001c1000002570000000000000000000001c10000025700000000000000000003070101070101070101ff52000c00000001010504040001ff5c00134040484850484850484850484850484850ff5d0014014040484850484850484850484850484850ff5d0014024040484850484850484850484850484850ff90000a0000000037c80001ff93cfb2e6c1220e824db74820892dbfcc670cb5dd9c534643c011a87f2b9395e023e4192fed11fbf064aa811c5cbbf92cd852f1341951876d32d2e4e6b63fa17aee5f9ca4917766b1bed606924cd3c2a222d9a94a53d5b3c8439e7ca323243d152462fd13b12749a4bcd1b9cf37ecc2b8feb379be49b48b719b47ddd5f44cfb0834df28710af8e0666ae4abac8ef7ea513fad60d7a4d7dc745a0b4299cd4c5d817087eca6402634dba89d433aac6c40b2b931f5a33809f7e753843e6d6c3e15f0e3539daf871016189b428f26851d526ef45adc79d0d3bc680adc7128132bd1ed114857868c33b504278fc7d3ad802ef8f20ddbb0ce47cbb6ebaf21a1841313756b09813675654e4a885f28f01541fecc5859b189ac6c103110089d3e02cc29d1797733f03bf06e5e01fdbd3d45f2429a15f434c0ce974094906a0ad250bc0ccb533ff554728ff142e85ef51dc7e246e81ce0d8327b6c826887e19de71d54f02c80a7e17c77c585b9ef63da1961d171944563afbda697917437c948e3b1badc54114f83e6286ce8701ab8f497a6c6de43cd8fef3596a6fd616af80eedfb310c674b53c57fcfb2cb3361aa80cfbde521fba15d3049aec224d03de7e8226755c2378af0c5c84cd7f9929705534b635989ebe43a908ecb1a6cb061277692d4751d36d49bec55316f4f82facabe0e0fd8183ba1ddd36861fb078c926a2036d13d8f588880eb15409566237631009e1da1601a8512b5437aa7eb30ff2d2b4b8d22d7d672b72ab40b52b49d612ea01858f75003af1c43ec8fc09361baeaf6ca3fe8fe2a956f5b9465354afdf04bdec014422625754cd947e959dc66a50c43de87d0ff35b491b3d0bd1252276fa236227cce31eeadb9c7db5447db5c43ecae40b63a817dfd48c5ef9fd90dbc39e9d671893ddd8530fc1d057ae82b863a5d945b6e0ca0425eff2dc228cda810fc87b11bab20b0509912b0ec4a73da449c48c55ddc3f637098da1fe798e5c587dc4b43960ef83e4f7a778b710f1b54c4e3639f5da6f4f569648a719ad9987bff54e863f7f59b3d01e7f0d0ce77ef70d95348586225b436acf077b47ff0f8567bca2ba77574f2edf528768efeb79cc3ff803899f784a0b8931fd3593fa61ed3ca62e197163c0fec9114cdb4323879064e1ee9bfebe550095429f4c2a02984d4206daa242d54bb686d7f74acc0019c948536960542218dda559154a18d4b9a41240c90f1ff10794f69e3ed525e70c636da183e68fc47315b57f4c839ab0e3085dfdb71bc9b5d5e9af6e5f5cd18aeb8220922b6eb5ac4e3683141f63963195dba0943510883bd15042fcf0f427b791bc03d1cc762084544c236614653b8c79c445ab1a86e2ff04fb2ce828791432c98a498e584503791a8bde21db297bfca4ad82f89bc5499c58943a3ed003285b1fa22fd395fbe2edc95a978145597632621faaa5d1204d43cef12b0b5a7ef98bf25f0f48eb6c025d5256a8c1f4c6cb15b3c1c3c69e4be7e85f3725802b1bc0d16328bfb4edae90f2cf4c43b54876f4999c85d2100b8cac0245f78429fcefc46637c4de4f1d7ea4e9bf3b67cfdd1f6b5e4df26b7b5e8268f09b7971e6fe8253547bcd0f927a3bca22a4afd7f179641e022c00d7ec15ea4352636aba95f9e2f7137c1f1d6e1f4e9a83e4a48a1da32f21d64662b710de56f16fab52ab3844f1f0815438836dc482024bf60ee168f3c20fa3de59c0984d837755628534beb65b99bf5577f91f0d51d1c30dc0599e4e1b3403bdf4eac28bb51653c610f7a37816ba714ba25389e85cec26841b17337befe7ebb9a87529302ee93a411faa0092b58e0cc6eec5d3b4c0ac0318af94023db09089d34013bf144fa5571343b788d656344908d2be3b3901cd107e6af299bad36ca83bca566b88294d6410473cae49efadd8b45f45c084f21b9cea0a1356a88f70e285be2892c0b7811cd7bddaac30ca5de937b3b1bc639aa5483b12b0d6b94851bea569a15f71c0c08c737a180b1ef6b53c1be5b0d246acfbc8548f26efc4cf04ba201a4c8becd3039ce84ff223f7eafbf117c96cbcd427848e3269697807cc6234bb8424e286715b3ed2b82f8a40b7d9385362ff94554f87030c3e9d4d0fa753c1f2de88aafce9a0f48756eeb211cc47939031124de2aec73bdd12c606918dfba9d8d473215258426084bfb3873e01a1d02fb97c069d9d600e36bd803fc4219a74d5249d9099befa4b074fd6cdecf131f309a4e8a13bcbc5fe44f0ab93f874762e9ebf5299e79bbb90543fd86ac5cbad7c166ba0c2dd68cb609fc82c0df5f86f189d8b96ed934037a70eb12799a63d97faee74fe4e9b6119c92c616a3a638463c3582ee10fef390be7b93c9750ec3a23c1a1b311609797545150e534d28bf7be0b5d220eb6a77937db9aa06d3946dd25c332dcb7535beb8562437928812cf0b62a2b44f8b2fe6f553666697bff41616d0fa08fec49a09bab94a4fefdec10c337923cfed181b123f7a0d7b138e6544faabd34d7f8d76c9f66f7544b5f2ce995360fb62e8d39a8c73c684487d5a8974a9e11f115be56be11687429d5233c731ae357ff4d891c89c9641a46e6a7e4f2731e094118be33a6be5526e4338302fb7dce7a373f216426d094a25eb92761e7a63ab5c637c053754cc9b6c512395dd6cc2815215443624115c56ea8073d0f5a22b77eaf168c894a614fc0017864d06279c76ce2e07643233d633294074c5b24e8172f6eebc7940e28ab27af94bc1ca351ec2caaeef2974392204ca01c7dbd2547d5b210fa3b140e1edb439868bc58544a09dcb69f651e1a08fee0b27231dc99d161c6cc157646d4a0882aade8ea103aba7c8a19a3df95681e82c9f7ea47f744dd234cad32bc79bf8e5978afa9ca938780344dbd6b079315bcb5fb016bc63240d3c3337e11efed0f11805952ab7091769c7418c178965cc791f11a87ee75f37b4b9e858766a7a81863412c7d98e3e6bf13b4c45cd77e8c9e54d3f132411f531ab079bce5e99a89997d78be37d825426f72068bef69419f4e153aee4a19da10b566d2a1be0536964c465b61c86ff276cb051827ebe79760cc058b0e1edce29d54b7ce4b89d6a1e70adf5112253d5f8f1ca7e0dbbaa88ac0955d64c63b9e384f0caa700a5a15392f6a8f1f9a6cb5a75234fd6957cdd3f996e23f22d85368b828a270af3fac430af45fe63f7020633e7d007d4ff04daaac71bdbb2e48d17ba363aee51fe57041f052768a4d88a45ea84e9d5efb3fb7fb51231e50cee3d33e2b52ef0757a9ae57a798f7a5ac8e17c0d70321b6de6277c2f5b1908487de159e43606180459688e0944e876c0356910c830701c4bbac19cbbdcbfa438689863393dea69bfbcd925d2101215208165b39b0c122b75b254529d8ae368c24bbe37216cafa480dab15eb0ec9ccc10485e51d4e81ea9d8d8aa41b00516c64cd651b40854109c42497acac9341e1f0b7de34e4afe71c39bc3263d43b92a83677c8d612c62417a23e7d4afdc14dee8ed0650fd92827eb2e140ef1df8781b40ea9cf638fdcc3e947aa4ac35330ad63b838480c4686cad510924fad1fd8a1d694f68c698fdcd4860f0047c9370a2eb0dda9ef2226cd4c84a6edd5f6fa339c52979fbb884751789e4c787b0c38764ae7eae00a9c6c6c5cf6007630ea392b8034dee4ad43c58642b736f5d05552b5c290105293d6b75634df2d2c00c63ced63b7e6781208154d17ded0f8093b0db4e073cd429ff77105f4ebbe4ca09a1f0d769ea18c4f78c6e30847e263393560f1c9ca8f71b2b13efc1e9a6c49cebc99702df60b6a6e49e8ea20943cfe2285453d4a789b5f98f4ce799fa110f605b398cb996838b884213d6070cc59e20824b5a0fac13817a67d89d08f21ee18aab031ff7ad097c8e1d54f1a58008e0c6606aa4f8d60963e30b441fd8672b92045ae23fe980a32fb49d163efafb300497c35aea1097e6279569ff35bab9d803f9f515a77958f104aa2531e9ff7fbf800ea3f8e3c9ddfe9ddfc60916288048ac35132f1e07871fedace43564e4f12d512a7abac41566133792a0cd46cf765072c9d40c11f4d03acec7e7336e8a713fa071828bbb3340e121d7b53eb305244a3f07c055b5c8a411e03a41f57712787d5f5fcda30eb9d112e9981bf7e4f2e5a9c2b2a7f1edde626d8ce84bb4771d9dc751cad7962795fd8ca65ba6db1a15a3dd7d5159b116a5db0821883b012d513939ee856dca6dd6fe2483d86bdb7afe0f0939998c6a1ffcbc16547ddd44de1d9d70abab8ce5f5021e89ff447e4c20fb7f34175da809b30a5eb92e0df0164088f9ef85d87c4bea97b509e394d08aad38201d8b29da809c8805a14b1454aa5ad523abb0462651478d46df0fc616413ff954432d63c88619009ecaf74a7e53c973eed928765a63c5b84932957bb48c4ffc27385118998696e1628797c79d38a96e3f21c413fb3cecb036234809e888a2bc714602890b3dd1664e073ab3e8b436c93509a6183bdbc7217ed4d0e9d295bf605e5641954942019f70059ca9b00170ecba145fc22a04fddaa51753f70e5537601973ae39e2c307858b503c1970a364def7c56297c8b465b6e0d88a1ec2702a861b7551c87cbb95d91224f9d4fa8e96bb14da86500a03b7dd547e59213c9207360408cf1575eb4feb5ed03743423a518ca528813b0de2f6077b22ddcaf2c6658ae6dc392a972119c8253e6f7e45e6260e78edbf3ade798c30c5197bed39c1f0f67c1f0f6340f83d09e01ff3efbabb4252189fc27435ae655687b9c546ed4e6c6c6a33ff5bd4f8ec537bf8c52af00c61a8558e18cee57d8e00abe6db2966684444248a8631ad409fefc06f6d6f4e37dc0c40d403d472570048b5f3dda941658554c1da73443e914eb145d90ce8bbb033201a12fc0ce77fe672bc8d7f5d0ebdbf1b4bba5fd6bbd26e7cf9849c734f86781782a1fd15c36cb1ed0b15b17ece634cc99a0c6899b04e18079924cb935e21ce43c64cf4372f9cb5de6f9a2e3965f8f5656f4d7082d7cc6dae65e5e49b38fdb1464e56043bba8a11cc6f7b1bcd376425e54a7969ede6738388a20d473be75f8c7737a44fd0dad03b5eeddf846dd503c4974e53cc610cc6c424f8bbe6699d5e5b60a57e79a83c6455a757df93da24a28192193866612681a510f3ce0266501fb0fb8676bbd730225fd06477ef60d8f467d10fc00155bb094bf39fb466077ce49e9f909b94c71bd3905c3d8e2bc2bd24b07a7b0bef5a4bef81c2a6a055d930341a0e144ec61e3169cef1daa1ae7714174447b4b0fb28eae7b90306636230449f307dca0618a6cd200dd4e3314a9d88c3f3029a08459ee41ef01346b16eb9b7bd7d41e5b4f25513bd0ff25d4d4d58229835778a21babd3593c07a866953d0b72272660ca54efdd17d05c96e87e62498a39ce00fcc8d04545c4cee75f7aaf89d2e47fea3f6c7653f47a3a01b443b09be0e79b616c2c52a62f0b86439a58f845f02c4bb650a7ca0fde79d225de0a869838bf7c778c93db983127a214111cf867670d09c3ba76322d3329c48ca4bd9ebf6baf2fae8f234fe8aa2d2d49340ec4d058f102deaa111cc8e005a9f565ffdc39c6939f7a21e58039c0da46e0c7a68474cc94c5b0e6adf4b2e461518031d824bfdf50aa57577a8c00888f3fd5d7d010dfa5ae181c756277c7f63a76cdaf8e29124126301bd04ab073212c3e4e8fc3e4e8341f17524c91c780acf3703433318c36ce9b88e39ec57213120c3a521e90d98d5c61ce56df15c01f9671a358b39aba4c17bdcd7e51315598f97f18149b6515f085eeb5c4601e4e008a94a6cef9d5ffe6774a1856cee163d6e73138d9b30bca36e333ecc0114d0f0da226fd8b7771134a2600603a6425011ae565bed9585c95448d0d95e0bbec3cd79084b4cf1f1908d2ad10663f34d5fad06ccae5bd50c9dfe2ec7bf801312ff579db42f2f18b3183fa36052b39b88fed09f3c18b913a9c65aadd59b4b9676767e935aba94e07405ccebb6224d8424daabcd1d5e19857026f2e99640637fef4d9e7857a1735948be037fea8b7c9190e57e96a8258c10d05c191384f192f9485573fcdccda96880155fbf18465a729a2e24150c5c56ce7b1002846c8ec5cc65a888ebbd106ffb5e96f66a4396e61ff5a2281d7db79a4a0ac87ff6124e6664fe027dcfeca871dda222675e16d8e504f3157858cfbba500e7b1a059535a10f2409ce02a22105c411507496a5a375d5f4d433ffaae0fed6ff78cbe8893d118dbe87685e44ef1554a3295e09ad7837d92726c66920fba38b06b92abe4acb553f8ea11f075ed44cf642c0f1418717e7ce831fa97a35e8cdbf947d29d1f700e28c953dca1f4ff3fbbdaf792b977e39c90a8f08eecb18fdd176b9e25ddbef50b3fa3cd0d0e8fa3bcefc5b5ec837115a9b3b73542dcae5fe38f062a8916299550456e489fb613c2b5d6dc30b36654a49e9ead5658f8d1bd540cbe309f40222dc05959d5a5ed4e13cb56c2fec22a9ad3f09d69371b47199f0602a5fee5794eb2d0f9b73d21adf6c4b53b16a9ad711378a06adab4c68e800a1d9918d1c465e78de8fb32981e7ea14e4f41e2b4b1227243139e49ea51ded615c12c4bab004c283df7dfda1343f0c827915d7cc8bd6983495c9ba1dac9dfc577348e5c2b2cf1e7efaa93a9bd834b4885e12cf2512a95d9f570e9a12296991cd189bea87e9666f3cddbf45335f96d5528aef48cf075c8479f14933593018e0ab86b603c8574f1809ec08e04c3179916f9b137d929ab437c863b1c1c31aef57a32ce0c2d8548c0a061ef65f1bf2831e9143887d52378bb8a0fd270051bc1f5383e2f70587d422fe58eb7bb365dfe80f21302c830b725b55f5507bbf3d1e7026fceef20fa77eb0db66c987ca201adf0e949d54a86b47f40b00ba8017ea71df1a0aa33ab566d2e7cef39b818c187c4140034eb7df51cdd469c9ad7e2f93d187e7d338fcfe93ef92e587e6f40f7c578f031d5b1b7f013466dea1e8988d9ebb9064f26f06ece101622e393dd72d0d53b2285f8e92602b1ebcca36fbdb1b59b22607d9b6badf4e9a052e3698057c8338e3702358deeff4fd640c253994429536015ee832877a6202ae56f6e90e97f98d97e3bd006cd094fcb787d050f8208bd3ccab701fc0fdeff0f3634c426891f7e9f453ca0dd29fa3156f118511118e5381c211c958953b4656cca6fc4b265b860523e93dd8d0d38b502b9dfce45ff5cb84acf6026f7939c9d356edd314ef001ad1d6ea4f317ebbda9597e080c2998fa7515e559978946b32c2b3a512efde543a243d4f27661c0d8554158248aa2a66656864472a979b8f1f811a15eeb29f8f62aa2cd10b75e62577eac19d1da016e0135048d07ec4c3ec8bdf904cb5c7b5e45896eb0a92c292ec78a39424e9af520b815c7a5609932f87f330e1d245c56e15906e90604290f043458a26616beb5d9e2fad5f0778aa0fb4930db75f0521ca4a49dc7fea271a888f06f4e085ca839d22fd4d3c4e2ee26ae24f87491e5db624b00fac288024cb7ebdf61441458cf17e1a57018988abe350182ee0f421e45b232d516d11c5604365ef7039f42b7aa3035a80f9dce25e24fb2324b8de8fd59e2d026fa748692e745d3eeccd90bac74f78af42a405c2006036a63775faeff13c7502672155a2ead9b8ae129dc43f133d20dfdecec513987b6b16386f5a0150a97fd9a10d91b57c6d998340433e2258f92bdbd1935a1bdb8772721678a7f6b9b86e7a30ac8f55e405d8ff184b5edce152906c322864f1bd326004c207e55766c3e79995ed6aaf4b42d7ef3503e5494bcba14a01ec8dfb5114b7ac07193805ddbcba3c957271e4a066876d3fe785cc29233494b3ca7be9448b7dd916a3fe6a9f0fc40e8455963888292ada0e82ed45f014480af6d7aa352590680aaa713f355cb0ffbb22efc989921f5d2f6634ee86370a3749500c9883ecda404c7fef160c9c35fbec4e1761f92843bb8170cdc73f78428c0549e8982bd83e9fb8069942b51b711a3110e0dc0119f1c5a44a7ecc7a67043ee6f5615246562edd08f361cb6423e8c7a2b18a1fa32985074eb1691aa9989e0e4be99a6dbf401eaa264b79ac3c4e3600e7a199145bf2ba70c8856b0add3c9ce630734cae5b4085adc4ced29b80c7f31ca27d17e5e49df5ad5d45dd4ced4a202bd751a897a3c7afe7388b2d2b500e5107b27d2b38927351509bafd9ee63b03eb54e0f24d50f964d84c0e1d9f45efbeb286b6a63f75ddcaf924d20fda26cba85d62ceb1080d65a9424bdf79f3ad36d1a6d19ed3abb4d40fbb75079722352dc6ce00d23e2108efcc98e97c7f91d1be5b448e0f0d5d8752ff1eb654aa36fe03b92c2fb57c94123456af3870f0bbf9ab70597d4681c53cb20759869b5abf1c681a3fc8c100045dbe699fabd3654f99a30a4df1afac733491b6914d82173ed4deda04d87c3dd844745cff6406acfe968d472cc7205fd1f09b78e2788d7f262b0927b067acb701ed377a983bc1876254a44b27bdac0cf608cecadc3abf300f513a991d9279eb2150dc365c73ae5ea1489e964d397f79bfec94f18d1992c6e554f71322a3a2cfb31ef3fb3780fd161c6b58605dbfd66162d25228e88cd0fb63bac047c3da63ca311b0dc79737fbf1c5f29a02a7a72a862a9056d4d03c85c38f5283f910e507e39ed1270d01284d4a9b87f3d06017e3e298b3e8341f9d4a68aa95ce4cdaecce30ef6ae552636bd8c5e62593350b10ff0db22717906118d1c08261d8477cf318ff0de7077a678d9a6f708f7eff2fbe1ecae9dee2e9fbf162996ec2fcd6463ec08f8db3392a8dc8b9f060e7eb0fa627d6a9bb7d6f38faf804a8d97c7acfba40ce3cf6fde1e831b8f68138453cdf0eb896d156f0f55400f80b9a7dec16083fcadef836373063a70e4e0dcdfee3f9a7eee992627d125791b3e5168544ca3c6f7fd09913c753b61d1ccad2e47939b0c047c96ed93e4f27ff48d7e27e3ed1f7452fa7f38e2bfe7d7406e62ba2c3273ed352dc0c3a70cca36a183bccbee664388e213f9834b4944543d2ec3a3b178dbecefb08669fea9d5f6ff38b6ad24daa728e9f953362d47cc796e9f2d5301c10b9fd1b785b101a837035e5e0276b8fe9ba1f9c7ee7df6c57d864164f0dc23770dbfd4d981d78c1e318214111ca6962777eb989b620f753c8940e165ceb90a764224ab8ab257e44deaf74068eb4a83b9ffbbba58ee9219a7b45a36ee102bc4fcb0e053a059631e7ea6fd03932494ff1b643f9f42fdbc857b7a071f63fb190bb93f65a03d1eb0f76099230b8445a3fe0186ada1bc733e7a17eb10e3479f96e12538eb2af3648060b5b1c43aa51a3bb2babad2eeaa7b19a368c112da167e8c9fef6047a6b9b0b4dff25b6b223f0a225ebbb0da9502f848c0f5a47e73f43da458a5963b292154aa0cdc32a3f38de9fe486ae3f3db7e56fed4308f143193ebe65786225be3923a6afddfc90a2b8240f1ec4fea26be09801fb1e6b570c19ff4fd2b41357524656a711710f264a70980273e481e44d23bcfe2e058075bf2bc1f406fd6136ed889da512bb3fbcccbfca95458fa57243ca0b62b19fdfa7cdaff310fca8c466f964efff1f2c51f9719a2169470784cbb303b9837c5266f54b26ac8493e67c42a3eab66a7f8c94e136acfc6d5878e520b5d82ba512cb739cb894ced6513acacef27757aedf6084785d85c209703960ff031f1536db22c5b3f8dae87b6976543e1a7230b91d9788c5c5327c5ae3971940c124d6641a247c18f93bd84da7a105649d0275f724f550647c78e6694084c0e58c39403f56aee1783dbb3fd41883acb4cbeb1adeae8292f9dcc6ee1cc85be00128bd8f20469960555afa31647fc06149bb9ea21f41e53e7058da9b134498e0f7d13f747c1ef7dfb5d83f07a31f5c80e23c6bccd52564d8dce71fa6e232198a57eb21e12d7bf02a7da57d35a4cb443c23b692a05bdd90d7d96d623a276e0b5a6c0f611d3bd68c625f5bb003ce359d85628e68bc7d69566badafb830749b7bb93b14d29ee0cf7b064c8f4ea4a588c06401f16c3b5893eb08acbf7c98add32eb60c40df649506aebb9ce5fe125c3fd8fcca5a0940e7df244981e344b17e3318f96b2f6645eae98d5a248e800c0a3a2083b4850aa91a50a407a36e455049ddae073ced22cb7385fe67590705c4de201c380c6fbddfbbb0e944d4cc78b594e151ef46e717e77833cb1921411e631008e61ca846b6e1e257929a020c4ce3f23f97dddfe9b44f970a81085b1ec544ba1cd0840729c36d9513ec7c5ca60344e78f36e9fdd8183f006c0b6129804b0f9a7e602052129131ce14318271d93e8380a66c3e8a53ecbc428fd422126e7f4482ddf0998f8d7171970d080e2e30223c6a661cc39c527e100aecbcead775ee35eb437c6e2eeb746fe5f823db8a3f5900bf73882b520421c8659d0b33b9691f8da8494a1ea626a4f4db4e47a89098f14bb8e52c1b3057d9707e587995b56cb8253e6ee471ab584b90b73bcbc984d0ad3184e896b7e26c8af7a65269174868e013422ded7a90690b7110815468ab74fe326fd09a8aed7dc9bb6392aec343860ab619cb6cfef2674e8a5b688d6c28e975ef4a80e187593fdc7e31fad4c37acfefe7cf824944cb43d1245ef753746ea1b200d07015b7daa3c3404978c1f9a9d5f40036861aab00914d9b3de468d346004e449e3ba1ee050ed877a61d20abd2b151f73a0dba0580000ef5ecd8635a5a1d825738fa6956a08262850cf3a23ad38d9bc05c2f562c294194c073d25da21d6584ea851ea9892f8dc0fd4cfaa874179a6571fafc5dbb9e2fda1786044ee3c1c222ab44feb4c19d0198879a18b8e0f396e17cfd09234bd004b4edcd178b5a1a403a3c04dc4912df7f293a77501b51f5a1c7da8c95c968843fe5e370ddc09c3c09cf5de4d9c9ddfc14f82a675ad0a415f14b07cf0b4897b7c6a1e7ef021ab7e397c6cea3abd16eb2fce6d0d231dfcf1cfceee171d91fa027ccd3e154b53bb33e2a7666f95d9985baa53ef69bdff74febe8a4c559c65d75170bdaa0da3e3b4fe41303f31ad1c17961d2c1967e1e8751379027c1c4f945ed1084686f9bf6eb79f636dbf6e2f6c73fe97dcf275f217026186bbb0280995d17f4875294d7d59d3d10510e81dad5fbba841b26275a6b2d14f52254732c7f65358bba3bd9c4f782f63226e628d7e05c4b58ccc43b726d4202380147b279cafa3ad395b20bdccabed3ec644eb68cb80a4ddb2eb67c21398e3bf34adc7c7909f2cc19e99a603abd0edf4fdcef6666b35c66706b253ce1f8fe81ff45a9f0fc5ee96f83ac707e1fb10fc1bf00f0315395d78708a73b1b766bcdba7d7a18690fce9bd9f626baa840ef205d7e096d63d9b79529ef143d3fd5e636bdbd41eed8db9eabbfd25eb04a308ad5d6523035319195887ad36e2a2ec06354942608b28e931cd87bbd602c9460cdb3bca62aefc6a5b15d958b7bb0d255b660d43a97ce42e3210854e1c805523115efac90bfcf531e3688a1fa83f337c9cb3cab18b0aec6320d9a818ba5e742a310a81300d88276d5077548f388716f6f91f32958f2319567cb3e34cfb0e65f348362e13eaa5c7fb9fc4864f9dd7aff20912a4b685d063fbb6c9146f8ad5d522027dce7c2a71a95428a6bcdd956327c9a6aa6c96cca7ae1f05129ca07f9b652cd02322e3af11067d9c3bade38fec4019b7dbcaffe356092761fc16a633939fc4a511893270b3b031c577272da0e2e1994be593b289495547ba392fa967e9179080f80b1f6b0fc6f780d54d937266418255adaa10146a69db16b74034ffa572ba0760d374e6ee5e65c8ed8f516f53d1b60b494033251bd4d5d42046fd786ea4318941d237745f84debc93daa924ce7abe0ab6aa6eaf990766bdc3fbdd4c5aff73a6e50a658d8a4c84133dbe8628f24becaff0a55ff0d1276b906ed1e743951192f497c9c7261ce088195b7a0e06d14293e83ca5931f5dcd87f4f97b19ebced8c9f5512115eff7f078e1459e9b70d0fe211d7a722a010c0e333dbd2a37ea4000fb4f0629e3b6c126e145c7cae501b710992ca351b592a4d5af1b50051588c71470fe13831b3f42a980a42cbc7a900693be6d1be5b566e44a572936a5710b6ca88bab773c5022ac3c339bd8abc18e3a353adc186aff50057b0d4f30daf5f51eb3aa25cc2e25fab410bf3bc7c645185c75a11424537d04eb6f749535f6ed18c5530a6eaf3f41149773439148dedad6c6be535cc093a415080f98fc510c2f7991e3d2ab67bca211e4abb50c714941737609df863cf55f6f4e72dee4ef20236776653e786dd96f84e7cb7132c9799217bd7f83bc6b2d1bb6528c96e4e0d56b3aad68b9875c63c404ef87eccac80c041f6c4a7d438566ad0b1a9ff01bcbae95741c31ed92af7740a4882460605dec5e64b98e66e085a08b1c5edb7729ea26b70f7f3fdf87710d9170b16c0c357ea2dee230539b9cf7a9ce0f4640efb88623eb95ce07d94e5a0ba3bc3f0ba0dff706160e7c44721ed230e2fcb02ee64d3109c2f54ba778871ad46cfb0bb0fb96f8dfd2d9126c682345d49584d9c2f2455e98a10224c9649a531f74baedc425ee922c49de1b2a7257533d1416d220cb86c6d3e8acdd9a72ac3bd4ba6c83692290899646670c85cee12fb0f894a298c38c2119ec0f2f4dc55adf4101209c7cc0bd5711c0d5f1a68a5c06772fcc323c2e4ad58bd1f080a8c5c6f0ef6d6d47bd5a6b07d06e4a10a814f0d30a50eb565fed0bfa1b40836ca418fa14e4eed047a129245ec12e40362f54cf9c385b1c5a5e4f25fbb4b46afe1fd15e78c016e3a8a2dbc06fc268f38b5f0a6a3e849beabb949dc7a2e205b416c14175a5bf1dab28814039da4b13979c2b8090ee2b82a549a935a02d386e99f969f6d8ee021691326288b0c615e95748e23f8b8bc3b2f5f8cd5a4aa469d075418705ac4e01302d0b01242812298a625f0544c03fd3b424690204995ae7ef248d83dcdf9eeebb3fa30946424c972b3cfe4dd1e8330e1c45d8c18babaa94ef788c07d4a5079ac76da6237c0beb533824f4183e45596d3c837378cc3a71d0af3bc8b53b9705545c55b9fd3d43be2c8c7c30956f2ec96d86c0e9be75477f63b5d18372a6acacc0abd2249b328fe8d80e30862bdb47a7b4aa209e98e6348c68b31f3d789158df83274c19496346e664457b27c5533dbb1947ccbfc0fc9b3cbc5df127e8deaebc9dd5300a6895f0f19b9bb77de9d9206ed43a6e300be483bb302344f53eb66e9e6631be67ac81ebc761212f74ffeb96812b475fc4e30c36d4db58d9d04e4a7f531f97890adaa169bcc1b8bb2c9201145974632b53f39e3e32786bb9b9bd2aea6f8a1f39deccb30ea62169d00f9aadf5c25e905fedbe544cc316d9f0f5f9a41492db99b9b8d3034d235002e4884aa25574801024fb50b74414a7661656332ff01c3d6bce548b267cb422e0f179b7b434b38dc1777326a098b1da6dd186a7682eb7d9de86bdd448bb6ff67e02730d7d9f5770d234bda89e6831f663fb8a8683b944ad4bfb725a42e88c701005d7887da873cedcf348bbfa58e1cfdc2bf25f71796d4b9dc0fae0d0df6a3cab5a263a9d2063e92f57ffc1afb7963e531e94de951cc91a50d7af93463e5628a69e564fc95988a24f2998cdbd7dcdf0d3446e6edb9bc43ec4811a6a4661ee00f037e534874099302c914956e9283a4e323c21b522ef5e55910d9d67508020be05dd1c24e6d577bd2554fafd1746ebe5bfbccef794904ba46d95150e96a0dce03d94ff6a19556b1d9b8713899a2e08bb66297b2f39a0b6e021c0fff5812dee5c4021f5d60073b6d81d6c8ce650754483d09790cd32221a61c00ea8e17ce04e87516c5c65d0b67b0c0f6dd0f9a1d63c890e29a0fc6e073e5e71495cd23b1c5dd0887449a1437883144342a4882758f12e13c075d324af89ffb3ca74cf1f2cad3e5ba517f2e7202a2c60914c2700a69a50b634c50dc5a2af46a97bc7647f392c5d5fa8462ef64a5f7905fe42fa834885b80d2c3850fc42e75bd1801f5f05c43859141f029d7f913adbbda2e5de49afc0eae00b097b4dde8041e7ed62193260dbd0d69a1ea9869853cb750a8b967523e377c5b07e6bbedbca90a12e44659c0d81d45b9182c9f6e25b1091e53e0d7ea0fcc8bf7739dd69912d54d5d7d53a29227efbc3c8eabb652a4ef05aea085c418bf7f01a4b2348c7f025cdf10e7d9ec1ee05bd6cc91fcebbf7a26769e3226dffb6056736cf0a5025604d05ad01b2f913c53015aa817114274c2beaed58cad2c5a8dab848165985c62f473e11db326380dff2b679799a34091ef6183f72431c35a5908ea89b805259c4607f454045b0314d3d090dbe7073d037a177b7bf8d3e1412695443f9bd0c1ed17569400123b685eb9a293d763d3271c697910aa429dd11bbbf6b54b3fca8b763fa7057c5057eb2d59efc7a5266c77b1dd122f50c3e9e07546ea829b6be76f73ee70511494be276bdcf15d0c0fe5411686891c2ebcdf4c777643e6f32932b1d930c7a34c1ddb9dc5b02765827dc691e9903e2c51608c9bab3f06aadd7ad22f72ba69c70dc3310c29c3e7173e6d3a735596e0cc0265103d1fd34f6cf533a94a214f2d2724659c04c43b2c5cea1bf678be1eb4d53de297be9e7381403968c3c8cf1e81817e799da4ad63825c0688ce44a6293b796245bd7ba8dcba5333eeac8ecfdfaac90d2fdca5767e44e99e5ef3c731990e64e228966947918cce5d1085e04488e2c1b2e101e0d2b2dacf7e70f097e3c942a24625f3d3ea7d740ec4235362b5cb3e64a4904230adc9acf7c0e1e60e78bc382257460fb03a4465a8433ca92a78793521d026409ea03a3595fe2659c1b07ed9d963844eadb99634cd93e8f51f7a1e44a73748228d50b11814c58e8f55361358e928cada62d9c033fb95d9b5d190b85be76046a5433c8777a40ed3b4f53fe5dda02ecfd7c9cc0eb2e716119d2390a4c2d68c920a3bb0dfd274ade5b2613b2e11f61f28c70601d869f63661cb0f1d89e7dca39b7dd411f78093d1abcce0c6bca0a7a653c03ba904f8ee7a2e967802fc721cf7be8057edeaf04c31ccf2797c6b52f2756bc8489ac2feff71c2da2f5174a7db0b70f2ead350aecdf8a041df17b18d21a723b52cd73936e69e90dbf24501379baffdc717b7dbb7e343882c0b13f7cff51cc6a590b8517498a354ebabc66d0941439880b3ed045a96dc85417933b0a0c8b2758a2c5690aa8464eaa45f1f1ff51c0e127f6feb2695c15d950a3a2c02da5095ac6432e176efa1c3098d9d4f63cad1061e78bef0f478a7dc7077a2b1b25e799c7ac3fcf16a340ecebc24fc8f5863de3cd32af4d710ac46662bdea2395c721efef5b9855b4f7fb9d1d8e12d918bca15190989c56c06bedb25b1de3cd7c5404413719b467edd6e559d1b81077ffb445a5a1066b21ca81045938de9233c674cd8a9a5ca214ff0ab49abdc55b33c1010e526b7a4761e8e7568dd49a4351376a26bbf7cdd08444afc602bc2b723e7cd0c77a7ebc54c59592974719db777af3e8e8bce1af533f310cc8a881000eedde8cc6c4dc3ff032d17014423eb6979005bed8bfc7789a703e61e8d3de9ecb870cc4c862028d8c376bd35ee6399755642bfe3cbf27ab4218ca1f4d13dce97ecc634b820d0f4f97ee1f29c668cc0ca7a798ffd4768ad5a7d7e5b37635c51d35e1dd7377b82366677afe907c764f1f9b4894647db38e8d48f60c4ed8fb343e13be27d97a439fc5e8e00e40f483523974cfecde247fbe8433362be32aa14c1ded37737d0d4d5b781ac4729dbfc1308d8a8a41aa9e01da966ad93e2bf9c450c102b19b1f35010768ed7f9755d38491dc511bfd71a53ea9196eb1aa9cef181270aabf0ded26ed8fe3d4b7c1d2bfe0b1fc361c1fb5caeb7edfbdd77f5cad7b03a80f1a0db1ac2c9371ed5aeb5e57ce54332981383743b0375bda7ce1cd4f12b8eca061dbe5b7955bc11a5957a5aea6c947a3b9b3e68b2fa8d72e1c06d9a53f47fd39013882af372f42c1ae7250b5ec07232f69db062e4ed9ba8a4c4f8d68a43cb96cc3eaa4187f59feaebebe64b301804f4c5773fb83fc21ec8faf3f863d6cd7f4ad7f76b0804b5972239800f55e801c9a46d5cf1b2487ddc4eb884320cbc48c6c16ffc2e075c9fc903d94a097fc37f05fb7e6f6bfbecaa9fc0dcafbe45f7fc490feec1238c03897c19c5d3d5af4fc897c57241038913fe57bba7f0e87d47eeb4e38207d511519c3d39c6dabc335c630b654166c19f40854ffb0a477accad5fecf6485f41b6f60d9cb4ff3b94a0d0f4b9d38eb4c898a3470a5029e54111edc8fb3cf1c679245920c59ffae6002dace5c82710715076de8c27fce4eb1bfb5fc982789ebde424737f6808c7966124f6fcbafd33368b16661e9d41e7bf8bb711047818c283491615a3eed7d49820d904512c1303e1524f5ba8d35eb2a5d5f45780bf79fd3b9b90b38b70c13919d8454b106f734e7065ebb0c64f25b0bed473b1389c1d1123b3cb731c29cc83fc2141063cb5a0c5ada5d1c2102713cd23c3d74cfb24645bb008052109de3eeaa917598e6055e2ec146c02011c6745f0200653c3e4d1b8bcc45a067abb743bc0ebb0a2f9de087f987e83d376b565e21829556fe888e4ce32b2c2a6fe4a450d5473f3cea2b6f1eb2fb4aeb712f87e690f50f0a351f14785029cb77bb62b54c72dd04f78af1447a394fe6b08f8a338b3e01df33e7c56cc66fac12f23c2f9b1f9c0ebef422f19f87b29ba9a8dc566352bcbb88b00bb029d3750d5c3d306624c28f9411e2f596ee38ddfcd1c3012b602bc5db24fc632ff881b4f6e59cc6a6e481598380692912b611ad92f6e291869a51a6cc4375c9afc91a19d1b8c6027d3bad5f8d467076cd3894e3b258db122d32d9f8f5f025b969303e90595ca04a8d08357aa750311ed7a1d6052615d4fe212342b618f9ab1f17495aa1553541e763c80e3ed226c93c18ce9c8839a76f45a713561eefe550eb3d9ba2583548122c543b01089efd2642392b9cac225c34466cf4d50563d1fed3f13b3a6eb443868207e79f9d948b01884679767fab0d341aa2c29cec033bc9bb9ee8f5bf31bbb0a8e3b46ce554697028d19f3fae565ef3b0548c1b6709de50baa40ab16c3ab1be4a9964a1816b5439b615e3bcba7f2aa5bd5d76c322bf5fd95bf1bc81aa4833328f5d95c7905613c374a1ea761365f3704628bf97eba7e2e81b8945e60af27f77eb2d5cab51c31139e82f315b51ffd941bd87eb3587eadf9bb07ab7340d2978b6b9e4028db4131cfc1ae124b78b9f71f6dba258e3aac95a4576367acbc6f896745927981d972be4b2ea201908d254a68c0d8920dceb22f12e978d0fc33964250cbdc25106f6f22a791769ec6bfe3d9fd94364fb45b11a1ea9ab43ffc1e8a00b49064af1c5e255fc93919dc83229ad056ceaebdce1130601573846a00cc6d53b039ecfe418ad1d263efba5f9c1fe48a67360088ee8d5bb3a38fba11f0fe0f4b6bda7dd97f07a2dfb63ed7f0fbbdfba6fba5d7a87f8362fc1aaf0dce8d5b5f505b43fd4794844fe19a8e94b9e37578345f5b189eb1bd663209220d9ecdac1a7a57d8af82343fa0563fd2b7a6897c6ef7af4f09f1acda0e6ed87119c0106a84b91f2f91fefa85aa4b41b589636e6b6c885938078e59389f3b0731b3642e82e6f50f1eb3be8db1da1ecfe4219448abadde189e86d34fccb9858fe4dcaca5b5998efed37dd2df5fdcc98cdce5e9e1e4c5a75ced5e708ab2ec8ccbf1ea8ad4dd0ff5924c5dac7b6b86352616b811ca6430a5583b12e6cdd6a3c62fdab407213cc07b16fe730c09d1387d1b794e99c6d2d50a2eb18497d804340f1c929606188674f6aca645a0d61eeb05555f7b784616dd5280e71f215e5a640e5e92f9beecbbd5409af937da336bf455990b00b98a766470339a1bf60893e39c7680812a1003ff7d41320e8fa89caf952a1d0a51ec81ef7f633c30d97bee811a5177d1b35385b639ad3d46e5235055f262056c1fe72feae37f939c9376f5eb3bd4108d04ba98a9b8853d46a120f6bf652379304378c1d70d978d81579fed8d10662941145ad46d007944b18b66ff668e4aa06bdb1db94d037276c1ad824983fa4a51e5e6b7985cdc665dc6c302783ef2ff0e8984d7f97bf145ec8f810ee87429df4794180f546ca4563ada400779a62eb4d92b079bb2909c12bac926ddcf6f52132ebf9988414e068b3deb7f2055c94f36ce3177d4ef18ba5340526a36166f9739352c1347c25c51da62f068732a1b0dff760493012331139cac2c9f4411942088e00a5f20111b73b3b160e7ce9dc561f732b1bb3d0a5311b3b00f455ced6460f6280df0c5583b4f4e92b87ed60814950346eca1bc46aa65336e5614df624d90a0e391848ad966924e8073b5120aba6f3dafa1a1b1cd8fb33c3b694c59cba61260ecf5be06ce8a5ceae686aa910c7662f082262051d0ca90fa81dc6350dff965dabce380ec75ce09e358df50326ca589f5b28a4c102dcaf9d16f4cf5dc6fee8e378e3467dab14667dd46731cceacfaf38ea8883118c64724cd465f342a0e9f1fec21625b40f0a7449a657c6cc92242dbd6ac48036da2d86fd4faf51175d7fb0babc59ff74c06278aaf41bbe01bb7ad252152bb0927c3cd19aa7e375c79da7436892dddd4c9d80c62014faead7855352cf644bdbc6d923994310e897f3e1128f98d25830997f9c4b999784120c66d6abca8182c9859b96cd9af66a713fc134c3b734d3cccb16b04e467bda725d2cdd4dab48a316f52ae4ca2b8ba5dccb989a50f4c583a70426f490c8fbec912efd85fbffe9aff25aa908b4933e2914a52738045a3506abe88eb2761204df51b0e3f5a078e1d2577513e7114b04ce0caa7a14db9cd9509947bf753757b1703bb22e5849ae99a9f3c7757ca618896dae78649a430f63dff2927b3246f0361454d84dad2e7dcd803128075cde9a68670e63d3c8775510fd48b37ce12d26f383a2af6de9a180ac99e9211e4c986130fca30a1d04ea5248551354eadec7de69b5c3b24f633b9ebcfc65d354890733a6cb5d8950e33153d0408d3c6c2f8699dace8f8264651433d5a3df43cd42dbd7e0ab8ab318722b7fa7da522d6c011bcadf2353aa8f0d8df196d16aa3c9db0f9ff33b06bb11085dfb76aa1219cc60fe7ca842c75541614fc994b6419e6f945f9e8bbec12fe641b612929c2d171b54f46649325224f20c9ad7ea17cf3e4ef162c03b1dc1d9705ace871e9dd56046326a11ec7283987268f8cece6d6a4e2d2ef73f0e9f7f85a3486108fc0d9724d665f3b618d483b321e6aaeadb8c71e2ff622de05b5be235173b11efaa3355c74de0cd1ecd2e45b34621ff6d53907379c0c1afb5a6fbd2f3feea169f186badd48e7aba9bb6c8c851886d4cc9b954831eac7988f071028c51e3801568786868a49fbe6aebde48eb95cba7bc25d5e997ea1b7c53f1319a5ea4e9a296be5a31fd740e3b36c6a24ea4875822377050c14c5bcac4fe6541dc4b16ac084ca9cf48a173eff14c06bd0cd50f0dfe6bd5de24b9b5c0c00f416aa9109a8c2b971bf1651bc1599afb6b0ceced71a217d7ba6a6126c9110a76134e1130a728b09d240ad0b7bd72bf96d8f04d9ef252103fe4b7e40aececa0e16ebce28873ae14fda8cfa7962aafcf0fa5ce887caa4e68841ead953ba207e8fb8f868b65e6e36bb6b506181f99b16be8282a8c86425ecfa38372e6cf0f433154d41d72993ad55c15ff64b8a25b71aacfcb9b49afaad67d1802a0fd8a31d9b1143207c4bc046ed706b4b52749b67699fc32c95644a4277fddbc9d253d93d25bcabdf466cf18a7306d6c4dc1fb4809d9c092eb8c8c3d38704fcdfdff7f3f209ad0ecac090b782be41a81d652b72852be7a53180ec3ce2e5739fd51f31e1eac0ff3a981f0a9acc004730f1cba2dd7ef87d84334f6c81a0cb8c1346b9c293fba99865d0ef3ed12a2d67ed03470d3e90dde8a9ca04a2957af1dace37ff0dd808e5cdd2374d6d55b47a990ea9836b7096a30af2926bc65f138f5b1e939ca1569204b76db833316be19ba0c040c0e7e820bac5cf0deafcec5ced0b6b73c27c59afcdb0131cd402ef7cbdba4512cef751ea0bf0d9065edcc875ad275c21ffd9"

func TestDecoding(t *testing.T) {
	// Convert hex string to byte slice
	dg2DataBytes := utils.HexToBytes(dg2Data)
	var byteCount = len(dg2DataBytes)
	if byteCount != 14951 {
		t.Errorf("Expected byte count to be 14951, got %d", byteCount)
	}

	dg2, err := NewEfDG2FromBytes(dg2DataBytes)
	if err != nil {
		t.Errorf("Failed to decode DG2 data: %v", err)
	}

	if dg2.ImageData == nil {
		t.Errorf("Could not parse image data")
	}

	images, err := dg2.ConvertToPNG()
	if err != nil {
		t.Errorf("Conversion failed: %v", err)
	}
	var count = len(images)
	if count != 1 {
		t.Errorf("Expected 1 image but got %d", count)
	}

	var image = images[0]
	var base64Len = len(image)
	if base64Len != 53172 {
		t.Errorf("Base64 string is not 365896 characters long, got %d", base64Len)
	}
}

// TestConvertToPNG_NoLogging verifies that ConvertToPNG doesn't write to stderr or stdout
func TestConvertToPNG_NoLogging(t *testing.T) {
	// Capture stderr and stdout
	oldStderr := os.Stderr
	oldStdout := os.Stdout
	rStderr, wStderr, _ := os.Pipe()
	rStdout, wStdout, _ := os.Pipe()
	os.Stderr = wStderr
	os.Stdout = wStdout

	defer func() {
		os.Stderr = oldStderr
		os.Stdout = oldStdout
	}()

	// Convert hex string to byte slice
	dg2DataBytes := utils.HexToBytes(dg2Data)
	dg2, err := NewEfDG2FromBytes(dg2DataBytes)
	if err != nil {
		t.Fatalf("Failed to decode DG2 data: %v", err)
	}

	// Run ConvertToPNG
	_, err = dg2.ConvertToPNG()
	if err != nil {
		t.Errorf("Conversion failed: %v", err)
	}

	// Close write ends and capture output
	wStderr.Close()
	wStdout.Close()

	var bufStderr bytes.Buffer
	var bufStdout bytes.Buffer
	io.Copy(&bufStderr, rStderr)
	io.Copy(&bufStdout, rStdout)

	// Verify no output to stderr or stdout
	if bufStderr.Len() > 0 {
		t.Errorf("Expected no stderr output, but got: %s", bufStderr.String())
	}
	if bufStdout.Len() > 0 {
		t.Errorf("Expected no stdout output, but got: %s", bufStdout.String())
	}
}

// TestConvertToPNG_WithEmptyData tests handling of empty image data
func TestConvertToPNG_WithEmptyData(t *testing.T) {
	ic := &ImageContainer{
		ImageData: []byte{},
	}

	_, err := ic.ConvertToPNG()
	if err == nil {
		t.Error("Expected error with empty image data, but got nil")
	}
	expectedErrMsg := "data not provided"
	if err.Error() != expectedErrMsg {
		t.Errorf("Expected error message '%s', got '%s'", expectedErrMsg, err.Error())
	}
}

// TestConvertToPNG_WithInvalidData tests handling of invalid/malformed image data
func TestConvertToPNG_WithInvalidData(t *testing.T) {
	// Create image data with no valid JPEG/JP2/J2K signatures
	ic := &ImageContainer{
		ImageData: []byte{0x00, 0x01, 0x02, 0x03, 0x04, 0x05},
	}

	_, err := ic.ConvertToPNG()
	if err == nil {
		t.Error("Expected error with invalid image data, but got nil")
	}
	// Should fail because no valid image signatures are found
	expectedErrMsg := "no embedded JPEG/JP2/J2K/JLS signatures found in DG2"
	if err.Error() != expectedErrMsg {
		t.Errorf("Expected error message '%s', got '%s'", expectedErrMsg, err.Error())
	}
}

// TestConvertToPNG_WithFalsePositiveSignatures tests handling of false positive signatures
func TestConvertToPNG_WithFalsePositiveSignatures(t *testing.T) {
	// Create data with JPEG signature but invalid JPEG data
	// This should trigger the "skip images that fail to decode" path
	invalidJPEG := []byte{0xFF, 0xD8, 0xFF, 0x00, 0x00, 0x00} // JPEG SOI followed by invalid data
	ic := &ImageContainer{
		ImageData: invalidJPEG,
	}

	// Capture stderr to ensure no logging occurs
	oldStderr := os.Stderr
	rStderr, wStderr, _ := os.Pipe()
	os.Stderr = wStderr

	defer func() {
		os.Stderr = oldStderr
	}()

	_, err := ic.ConvertToPNG()

	wStderr.Close()
	var bufStderr bytes.Buffer
	io.Copy(&bufStderr, rStderr)

	// Should fail because the JPEG signature is invalid
	if err == nil {
		t.Error("Expected error with invalid JPEG data, but got nil")
	}

	// Verify no stderr output (the fix removes error logging)
	if bufStderr.Len() > 0 {
		t.Errorf("Expected no stderr output for decoding errors, but got: %s", bufStderr.String())
	}
}

// TestExtractImagesFromDG2 tests the image extraction logic
func TestExtractImagesFromDG2(t *testing.T) {
	// Test with data containing a JPEG signature
	jpegData := []byte{0xFF, 0xD8, 0xFF, 0xE0, 0x00, 0x10, 0xFF, 0xD9}
	extracted := extractImagesFromDG2(jpegData)

	if len(extracted) != 1 {
		t.Errorf("Expected 1 extracted image, got %d", len(extracted))
	}
	if len(extracted) > 0 && extracted[0].ext != "jpg" {
		t.Errorf("Expected extension 'jpg', got '%s'", extracted[0].ext)
	}
}

// TestExtractImagesFromDG2_NoSignatures tests extraction with no valid signatures
func TestExtractImagesFromDG2_NoSignatures(t *testing.T) {
	// Test with data containing no valid signatures
	invalidData := []byte{0x00, 0x01, 0x02, 0x03}
	extracted := extractImagesFromDG2(invalidData)

	if len(extracted) != 0 {
		t.Errorf("Expected 0 extracted images, got %d", len(extracted))
	}
}
